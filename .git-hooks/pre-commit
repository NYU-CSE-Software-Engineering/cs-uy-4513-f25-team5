#!/bin/bash
#
# Pre-commit hook to run RSpec and Cucumber tests before allowing commits.
# This ensures all tests pass before code is committed, preventing "fix tests" commits.
#
# To bypass this hook (use sparingly): git commit --no-verify

set -e

echo "ğŸ” Running pre-commit checks..."
echo ""

# Check if bundle is available
if ! command -v bundle &> /dev/null; then
    echo "âŒ Error: 'bundle' command not found. Please install bundler first."
    exit 1
fi

# Run RSpec tests
echo "â–¶ï¸  Running RSpec tests..."
if ! bundle exec rspec; then
    echo ""
    echo "âŒ RSpec tests failed. Please fix the failing tests before committing."
    echo "ğŸ’¡ To bypass this check (not recommended): git commit --no-verify"
    exit 1
fi

echo "âœ… RSpec tests passed"
echo ""

# Run Cucumber tests
echo "â–¶ï¸  Running Cucumber tests..."
if ! bundle exec cucumber --publish-quiet; then
    echo ""
    echo "âŒ Cucumber tests failed. Please fix the failing tests before committing."
    echo "ğŸ’¡ To bypass this check (not recommended): git commit --no-verify"
    exit 1
fi

echo "âœ… Cucumber tests passed"
echo ""
echo "âœ¨ All tests passed! Proceeding with commit..."
